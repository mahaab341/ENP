(self.modernJsonp=self.modernJsonp||[]).push([["8419"],{507203:function(e,t,o){o.r(t),o.d(t,{default:()=>l});let n={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CloseupCommentButton_pin",selections:[{alias:null,args:null,kind:"ScalarField",name:"isEligibleForPdp",storageKey:null},{args:null,kind:"FragmentSpread",name:"CommentsPopover_pin"}],type:"Pin",abstractKey:null};n.hash="069f535669d5c7a5922989e3b70f35f7";let l=n},20262:function(e,t,o){o.r(t),o.d(t,{default:()=>_});var n,l=o(281098),i=o(667294);o(422578);var s=o(20256),r=o(934645),a=o(980787),c=o(28427),d=o(19585),m=o(709311),u=o(941404),p=o(601686),h=o(230543),f=o(78762),g=o(785893);let v=(0,f.Z)(()=>o.e("30233").then(o.bind(o,210238)),void 0,e=>210238,"CommentsPopover",e=>["30233"]),C=(void 0!==n||(n=o(507203)).hash&&"069f535669d5c7a5922989e3b70f35f7"!==n.hash&&console.error("The definition of 'CloseupCommentButton_pin' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data."),n);function _({inCommentsImprovedDropdownExp:e,inCommentsPopoverExp:t,isEligibleForAggregatedComments:o,pinKey:n,shouldShowCommentCount:f,totalCommentCount:_,viewParameter:w,viewType:b,scrollContainerRef:x}){(0,l.Z)("CloseupCommentButton","/app/common/react/components/closeup/CloseupActionBar/CloseupCommentButton.tsx");let y=(0,d.Z)(),P=(0,h.t)(),B=(0,c.Z)(C,n),T=(0,r.Z)({showProductDetailPage:!!B.isEligibleForPdp}),{isCommentThreadExpanded:E,setIsCommentThreadExpanded:I,setIsCommentComposerFocused:R}=(0,p.x4)(),{logContextEvent:j}=(0,a.u)(),k=(0,i.useRef)(null),[F,L]=(0,i.useState)(!1),Z=t&&E;(0,i.useEffect)(()=>{if(!T||!x)return;let e=document.getElementById("canonical-card");if(!e)return;let t=new IntersectionObserver(e=>{let t=e[0];t&&L(t.isIntersecting)},{root:x,threshold:0});return t.observe(e),setTimeout(()=>{let o=t.takeRecords();if(o.length>0&&o[0])L(o[0].isIntersecting);else{let t=x.getBoundingClientRect(),o=e.getBoundingClientRect();L(o.top>=t.top&&o.top<=t.bottom)}},100),()=>{t.disconnect()}},[T,x]);let z=y._('Comments', 'Closeup.Comment.Icon', 'Icon for scrolling comments into view'),D=t=>{j({component:13464,element:2,event_type:10554,view_parameter:w,view_type:b}),(0,u.tj)("dweb.closeup_comment_button.community_view_intent",{tags:{experimentGroup:e?"improved_dropdown":"popover",clickSource:t}})},S=o=>{if(t)E?I?.(!1):(I?.(!0),D(o));else if(T){let e=_>0;E||!e||I?.(!0),D(o),R(!0)}else(t=>{let o=document.getElementById("canonical-card"),n=document.querySelector('[data-test-id="canonical-card-tap-area"]');if(!o)return;if(T&&x){let l=x.getBoundingClientRect(),i=o.getBoundingClientRect().top-l.top,s=x.scrollTop+i-P,r=null,a=()=>{r&&clearTimeout(r),r=setTimeout(()=>{e&&(I?.(!0),D(t)),n&&n.focus(),x.removeEventListener("scroll",a)},100)};x.addEventListener("scroll",a,{passive:!0}),a(),x.scrollTo({top:s,behavior:"smooth"});return}let l=o.getBoundingClientRect().top+window.scrollY-P,i=null,s=()=>{i&&clearTimeout(i),i=setTimeout(()=>{e&&(I?.(!0),D(t)),n&&n.focus(),window.removeEventListener("scroll",s)},100)};window.addEventListener("scroll",s,{passive:!0}),s(),window.scrollTo({top:l,behavior:"smooth"})})(o)};return(0,g.jsxs)(s.xu,{children:[Z&&(0,g.jsx)(v,{anchorRef:k,pinKey:B,setIsOpen:I,viewParameter:w}),(0,g.jsxs)(s.kC,{alignItems:"center",direction:"row",children:[(0,g.jsx)(s.hU,{ref:k,accessibilityLabel:z,disabled:!o,icon:"speech-outline",onClick:()=>S("icon"),selected:Z,size:"lg",tooltip:{text:z}}),f&&(0,g.jsx)(s.iP,{disabled:!o||T&&F,onTap:()=>S("count"),children:(0,g.jsx)(s.xv,{weight:"bold",children:(0,g.jsx)(m.Z,{shortform:!0,shortformMaximumFractionDigits:1,value:_})})})]})]})}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/CloseupCommentButton-dd513f85581b1375.mjs.map